# Elite Note: Warmup-Stable-Decay (WSD) Scheduler

**鏉ユ簮:** CS336 Lecture 11 Elite Extension
**鏍稿績姒傚康:** Learning Rate Schedules, Chinchilla Analysis, Compute Efficiency, Data Scaling

---

## 1. 浼犵粺 Scaling Law 鎷熷悎鐨勭棝鐐?

鍦?Chinchilla Scaling Law 鐨勭爺绌朵腑锛屾垜浠渶瑕佸洖绛斾竴涓叧閿棶棰橈細**瀵逛簬缁欏畾鐨勬ā鍨嬪ぇ灏?$N$锛屽湪鏁版嵁閲?$D$ 鍙樺寲鏃讹紝Loss 鏄浣曞彉鍖栫殑锛?*

涓轰簡鍥炵瓟杩欎釜闂锛屾垜浠渶瑕佺粯鍒朵竴鏉?Loss vs Tokens 鐨勬洸绾匡紝鍏朵腑姣忎釜鐐归兘浠ｈ〃涓€涓?*璁粌瀹屽叏鏀舵暃**鐨勬ā鍨嬨€?

*   **闄烽槺**锛氬緢澶氫汉璇曞浘鍙缁冧竴涓ā鍨嬶紝鐒跺悗鍙栦腑闂寸殑 Checkpoint 浣滀负鈥滃皬鏁版嵁閲忊€濈殑浠ｈ〃銆傝繖鏄?*閿欒**鐨勩€?
*   **鍘熷洜**锛氫紶缁熺殑**Cosine Decay** 璋冨害鍣ㄧ敱 Token 鎬绘暟 $T$ 鍐冲畾銆?
    *   濡傛灉浣犺鍒掕缁?100B Token锛孋osine 鏇茬嚎浼氭媺寰楀緢闀匡紝瀛︿範鐜囦笅闄嶅緱寰堟參銆?
    *   濡傛灉浣犲彧璁粌 10B Token锛孋osine 鏇茬嚎浼氳繀閫熶笅闄嶃€?
    *   鍥犳锛岃缁?100B Token 鐨勬ā鍨嬪湪绗?10B Token 鏃剁殑瀛︿範鐜囩姸鎬侊紝涓庝竴涓笓闂ㄨ缁?10B Token 鐨勬ā鍨嬪湪缁撴潫鏃剁殑鐘舵€佸畬鍏ㄤ笉鍚岋紙鍓嶈€?LR 寰堥珮锛屽悗鑰?LR 鎺ヨ繎 0锛夈€傚墠鑰呮棤娉曚唬琛ㄥ悗鑰呫€?

杩欐剰鍛崇潃锛屼负浜嗚幏寰?$K$ 涓暟鎹偣鐨?Scaling 鏇茬嚎锛屼綘闇€瑕佷粠澶磋缁?$K$ 娆′笉鍚岄暱搴︾殑妯″瀷銆傚鏋滆繕瑕佹祴璇?$M$ 绉嶆ā鍨嬪ぇ灏忥紝鎬绘垚鏈槸 $O(M \cdot K \cdot \text{Cost})$锛岃繖鏄竴涓槀璐电殑 $N^2$ 绾ф搷浣溿€?

## 2. WSD 瑙ｅ喅鏂规锛歊ewind & Decay

**Warmup-Stable-Decay (WSD)** 璋冨害鍣ㄩ€氳繃鏀瑰彉瀛︿範鐜囨洸绾跨殑褰㈢姸锛屽阀濡欏湴瑙ｅ喅浜嗚繖涓棶棰樸€?

### 缁撴瀯
1.  **Warmup**: 蹇€熼鐑€?
2.  **Stable Phase**: 瀛︿範鐜囦繚鎸佹亽瀹氾紙Constant High LR锛夈€傝繖鍗犳嵁浜嗚缁冪殑澶ч儴鍒嗘椂闂达紙濡?80%-90%锛夈€?
3.  **Decay Phase**: 瀛︿範鐜囧湪寰堢煭鐨勬鏁板唴锛堝鏈€鍚?10%锛夋€ュ墽涓嬮檷鍒?0 鎴栨渶灏忓€笺€?

### "Z-Shape" 瀹為獙涓?Rewind 鏈哄埗
鐢变簬 Stable Phase 鐨勫涔犵巼鏄亽瀹氱殑锛屽畠涓嶄緷璧栦簬鎬昏缁冩椂闀裤€傝繖浣垮緱鎴戜滑鍙互澶嶇敤 Stable Phase 鐨勮建杩广€?

**鎿嶄綔娴佺▼**:
1.  **涓荤嚎璁粌**: 璁╂ā鍨嬩竴鐩翠互鎭掑畾瀛︿範鐜囪缁冿紝鐩村埌杈惧埌鏈€澶х殑 Token 鏁?$D_{max}$銆?
2.  **鐢熸垚鏁版嵁鐐?*: 鍋囪鎴戜滑鎯崇煡閬撳湪鏁版嵁閲?$D_1, D_2, \dots$ ($D_i < D_{max}$) 鏃剁殑鏈€浼樻€ц兘銆?
3.  **Rewind (鍥為€€)**: 鍙栧嚭涓荤嚎璁粌鍦?$D_i$ 鏃剁殑 Checkpoint銆?
4.  **Decay (鍒嗘敮琛板噺)**: 浠庤繖涓?Checkpoint 寮€濮嬶紝鎵ц涓€涓煭鏈熺殑 Decay 闃舵锛堥€氬父鍙秷鑰楁€昏绠楅噺鐨?10% 宸﹀彸锛夈€?
5.  **璁板綍**: Decay 缁撴潫鍚庣殑 Loss锛屽氨鏄妯″瀷鍦ㄦ暟鎹噺 $D_i$ 涓嬪畬鍏ㄦ敹鏁涚殑鎬ц兘锛團ully Converged Performance锛夈€?

### 鎴愭湰鍒嗘瀽
*   **浼犵粺鏂规硶**: 璁粌 5 涓笉鍚屾暟鎹噺鐨勬ā鍨?(10%, 30%, 50%, 70%, 100%)銆傛€昏绠楅噺 $\approx 10+30+50+70+100 = 260\%$銆?
*   **WSD 鏂规硶**: 璁粌 1 涓畬鏁存ā鍨?(100%) + 4 娆＄煭 Decay (姣忔鍋囪涓?10% 鐨勯澶栧紑閿€)銆傛€昏绠楅噺 $\approx 100 + 4 \times 10 = 140\%$銆?
*   **缁撹**: 鏋佸ぇ鍦拌妭鐪佷簡璁＄畻璧勬簮锛屼娇寰楀湪涓€娆¤繍琛屼腑鈥滄壂鎻忊€濇暣涓暟鎹?Scaling 杞存垚涓哄彲鑳姐€?

## 3. WSD vs Cosine 鎬ц兘瀵规瘮

闄や簡鐢ㄤ簬 Scaling 鍒嗘瀽锛學SD 鏈韩浣滀负涓€绉嶈缁冪瓥鐣ヤ篃鏄彲琛岀殑銆?

*   **MiniCPM 鐨勫彂鐜?*: 鍦ㄧ浉鍚岀殑鏁版嵁閲忎笅锛學SD 鏈€缁堣揪鍒扮殑 Loss 閫氬父**浼樹簬鎴栫瓑浜?* Cosine 璋冨害銆?
*   **鎹熷け鏇茬嚎鐗瑰緛**:
    *   鍦?Stable 闃舵锛學SD 鐨?Loss 涓嬮檷姣?Cosine 鎱紙鍥犱负 LR 淇濇寔杈冮珮锛屾病鏈変韩鍙楀埌 LR 闄嶄綆甯︽潵鐨?Loss 涓嬮檷绾㈠埄锛夈€?
    *   浣嗗湪杩涘叆 Decay 闃舵鐨勭灛闂达紝WSD 鐨?Loss 浼?*鍨傜洿涓嬪潬**锛圧apid Drop锛夛紝骞跺湪鏋佺煭鏃堕棿鍐呰拷涓婄敋鑷宠秴瓒?Cosine 鐨勬渶缁堟€ц兘銆?
*   **DeepSeek 鐨勭瓥鐣?*: DeepSeek 閲囩敤浜嗙被浼肩殑鍒嗘琛板噺锛圫tep Decay锛夛紝鏈川閫昏緫鐩稿悓锛屼篃楠岃瘉浜嗚繖绉嶇瓥鐣ョ殑鏈夋晥鎬с€?

**鎬荤粨**: WSD 鏄幇浠ｅぇ妯″瀷 Scaling 鐮旂┒鐨勬爣鍑嗛厤缃紝瀹冨吋鍏蜂簡宸ョ▼涓婄殑**鐏垫椿鎬?*锛堥殢鏃跺彲浠ュ仠姝㈠苟 Decay 寰楀埌鎴愬搧妯″瀷锛夊拰鐮旂┒涓婄殑**楂樻晥鎬?*锛堜綆鎴愭湰鎷熷悎 Scaling Laws锛夈€
