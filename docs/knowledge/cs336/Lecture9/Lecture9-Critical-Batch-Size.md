# Elite Note: 涓寸晫 Batch Size 涓庝紭鍖栧姩鍔涘 (Critical Batch Size & Optimization Dynamics)

## 1. 姒傚康瀹氫箟
**涓寸晫 Batch Size (Critical Batch Size, $B_{crit}$)** 瀹氫箟涓烘暟鎹苟琛屾晥鐜囩殑鎷愮偣銆?
*   **绾挎€ф墿灞曞尯 ($B < B_{crit}$)**锛氬鏋滄垜浠皢 Batch Size 鍔犲€嶏紝杈惧埌鍚屾牱 Loss 鎵€闇€鐨勮缁冩鏁帮紙Steps锛夊噺鍗娿€傛€昏绠楅噺锛圱oken鏁帮級鍩烘湰涓嶅彉锛屼絾鏃堕棿鍑忓崐銆傝繖鏄苟琛岀殑鐢滆湝鐐广€?
*   **鏀剁泭閫掑噺鍖?($B > B_{crit}$)**锛氬鍔?Batch Size锛岃缁冩鏁板噺灏戝緱涓嶅啀鏄庢樉銆傛瘡涓€姝ョ殑璁＄畻鎴愭湰澧炲姞浜嗭紝浣嗗 Loss 涓嬮檷鐨勮础鐚病鏈夌浉搴斿鍔犮€傛€昏绠楅噺锛堣绠楁垚鏈級寮€濮嬫氮璐广€?

## 2. 鐞嗚瑙ｉ噴锛氭搴﹀櫔澹板昂搴?(Gradient Noise Scale)

OpenAI 鐨勮鏂?*An Empirical Model of Large-Batch Training* 鎻愬嚭浜嗕竴涓熀浜?*姊害鍣０灏哄害 (Noise Scale)** 鐨勭悊璁烘潵瑙ｉ噴杩欎竴鐜拌薄銆?

### 2.1 绠€鍗曠洿瑙?
璁粌杩囩▼鍙互鐪嬩綔鏄湪鐪熷疄姊害锛圫ignal锛変笂鍙犲姞浜嗙敱灏忔壒閲忛噰鏍峰甫鏉ョ殑鍣０锛圢oise锛夈€?
*   **Signal**: 鍏ㄦ暟鎹泦姊害鐨勬ā闀匡紝$|G|^2$銆?
*   **Noise**: 鍗曚釜鏍锋湰姊害鐨勬柟宸紝$\Sigma$銆?

**鍣０灏哄害 (Noise Scale)** 瀹氫箟涓猴細
$$ B_{noise} \approx \frac{\text{tr}(\Sigma)}{|G|^2} $$
绠€鍗曟潵璇达紝瀹冭　閲忎簡鏁版嵁鐨勨€滃槇鏉傜▼搴︹€濅笌鈥滄搴︿俊鍙峰己寮扁€濈殑姣斿€笺€?
*   褰?Batch Size $B \ll B_{noise}$ 鏃讹紝闅忔満姊害鐨勬柟宸富瑕佺敱閲囨牱鍣０涓诲锛屽鍔?$B$ 鍙互鏈夋晥闄嶄綆鏂瑰樊锛屾彁楂樻搴︾殑鍑嗙‘鎬э紝鏁堟灉绛夊悓浜庡璧板嚑姝ャ€?
*   褰?Batch Size $B \gg B_{noise}$ 鏃讹紝閲囨牱鐨勫钩鍧囨搴﹀凡缁忛潪甯告帴杩戠湡瀹炴搴︼紝鍐嶅鍔?$B$ 鍙槸鍦ㄨ繃搴︾‘璁や竴涓凡缁忕煡閬撶殑鏂瑰悜锛屾棤娉曟彁渚涙洿澶氫俊鎭€?

### 2.2 涓寸晫 Batch Size 鐨勫姩鎬佸彉鍖?
璁插骇涓己璋冧簡涓€涓叧閿殑瀹炶瘉鍙戠幇锛?
**$B_{crit}$ 骞堕潪鍥哄畾甯告暟锛岃€屾槸涓庡綋鍓嶇殑 Loss 鐘舵€佹湁鍏炽€?*

*   **璁粌鍒濇湡**锛歀oss 寰堝ぇ锛屾搴︿俊鍙烽潪甯稿己锛堥殢渚垮線鍝釜鏂瑰悜璧伴兘鑳戒笅闄嶏級锛岀浉瀵硅€岃█鍣０杈冨皬銆傛鏃?$B_{crit}$ 杈冨皬銆?
*   **璁粌鍚庢湡**锛歀oss 鍙樺皬锛屾ā鍨嬭繘鍏ュ眬閮ㄦ瀬灏忓€奸檮杩戠殑骞冲潶鍖哄煙锛屾搴︿俊鍙峰彉寮憋紙$|G|^2$ 鍙樺皬锛夛紝鐩稿鑰岃█鍣０鍙樺緱闈炲父鏄捐憲銆傛鏃?$B_{noise}$ 鍙樺ぇ锛屽洜姝?$B_{crit}$ 鍙樺ぇ銆?

### 3. 宸ョ▼鍚ず
杩欎竴鐞嗚鐩存帴鎸囧浜?*鍔ㄦ€?Batch Size 绛栫暐**锛?
1.  **Warm-up 闃舵**锛氬彲浠ヤ娇鐢ㄨ緝灏忕殑 Batch Size銆?
2.  **璁粌涓悗鏈?*锛氶殢鐫€ Loss 涓嬮檷锛屽簲璇ラ€愭笎澧炲ぇ Batch Size銆傝繖涓嶄粎鍙互淇濇寔骞惰鏁堢巼锛岃繕鑳藉埄鐢ㄦ洿澶х殑 Batch 鏉ュ钩婊戝悗鏈熺殑鍣０姊害锛屽疄鐜版洿绮剧粏鐨勬敹鏁涖€?

杩欒В閲婁簡涓轰粈涔?LLaMA 3 绛夋ā鍨嬬殑璁粌鎶ュ憡涓紝Batch Size 鏄殢鏃堕棿闃舵寮忓闀跨殑锛堜緥濡備粠 4M tokens 澧炲姞鍒?16M tokens锛夈€
